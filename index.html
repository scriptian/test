<html>
    <head>
        <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <style>
            body {
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: center;
                height: 100%;
            }

            div {
                display: flex;
                vertical-align: top;
            }

            #main {
                justify-content: center;
            }

            .content-full {
                flex: 1 1 0;
                height: 100%;
            }

            #stage {
                max-width: 100%;
                border: 1px solid #eee;
            }

            .headup {
                width: 100%;
                position: fixed;
                padding-left: 40px;
                padding-right: 40px;
                z-index: 998;
                height: 8%;
                top: 40px;
                box-sizing: border-box;
                justify-content: center;
            }

            .headdown div,
            .headup div {
                margin-right: 10px;
                font-size: 1.5rem;
                flex: 1 1 0;
            }
            
            .headdown div:last-child,
            .headup div:last-child {
                margin-right: 0px;
            }

            .headdown {
                width: 100%;
                position: fixed;
                padding-left: 40px;
                padding-right: 40px;
                z-index: 997;
                height: 8%;
                bottom: 40px;
                box-sizing: border-box;
                justify-content: center;
            }

            .btn {
                background-color: #ddd;
                border: 1px solid #ccc;
                border-radius: 4px;
                width: 50px;
                justify-content: center;
                text-align: center;
                align-items: center;
            }

            .popup {
                position: fixed;
                width: 400px;
                top: 40%;
                left: 50%;
                transform: translateX(-50%);
                display: none;
                flex-direction: column;
                z-index: 999;
                font-size: 2rem;   
                box-sizing: border-box;      
                background: #eee;
                border-radius: 4px;   
                padding: 20px;
            }

            .popup .head,
            .popup .body {
                display: flex;
            }

            .popup > div {
                margin-bottom: 40px;
            }

            .popup > div:last-child {
                margin-bottom: 0px;
            }

            .popup .head div,
            .popup .body div,
            .popup .footer div {
                flex: 1 1 0;
            }

            .popup .btn-close {
                flex: 0 1 100px!important;
                justify-content: center;
                align-items: center;
                font-size: 1rem;
            }

            @media only screen and (min-width: 1000px) {
                #stage {
                    max-width: 800px;
                }   

                .headup,
                .headdown {
                    max-width: 800px;
                }

                .popup {
                    max-width: 780px;
                }
            }

            /* Rules for sizing the icon. */
            .material-icons.md-s { font-size: 36px; }
            .material-icons.md-m { font-size: 48px; }
            .material-icons.md-l { font-size: 56px; }

            /* Rules for using icons as black on a light background. */
            .material-icons.md-dark { color: rgba(0, 0, 0, 0.54); }
            .material-icons.md-dark.md-inactive { color: rgba(0, 0, 0, 0.26); }

            /* Rules for using icons as white on a dark background. */
            .material-icons.md-light { color: rgba(255, 255, 255, 1); }
            .material-icons.md-light.md-inactive { color: rgba(255, 255, 255, 0.3); }


            .popup-list {
                width: 90%;
                height: 90%;
                top: 5%;
            }
            .popup-list .body {
                flex: 1 1 0;
                display: flex;
                flex-wrap: wrap;
                box-sizing: border-box;
                gap: 20px;
                height: 100%;
                align-content: flex-start;
                overflow: hidden;
                overflow-y: auto;
            }
            .popup-list .body .item {
                flex: 1 1 20%;
                border: 1px solid #ccc;
                border-radius: 4px;
                height: 200px;
                box-sizing: border-box;
                padding: 10px;
                font-size: 2rem;
                background-color: #eee;
                display: flex;
                flex-direction: column;
            }
        </style>
    </head>
    <body>
        <div class="content-full" id="main">
            <div class="content-full" id="stage"></div>
            <div class="popup popup-list" id="popup-episode">
                <div class="head">
                    <div>
                        에피소드
                    </div>
                    <div class="btn btn-close">
                        X
                    </div>
                </div>
                <div class="body">
                </div>
            </div>
            <div class="popup" id="popup-ingame">
                <div class="head">
                    <div>
                        레벨 235
                    </div>
                    <div class="btn btn-close">
                        X
                    </div>
                </div>
                <div class="body">
                    <div class="btn">아이템1</div>
                    <div class="btn">아이템2</div>
                    <div class="btn">아이템3</div>
                </div>
                <div class="footer">
                    <div class="btn btn-scene" target="ingame" id="btn-play">플레이</div>
                </div>
            </div>
            <div class="popup popup-list" id="popup-itemlist">
                <div class="head">
                    <div>
                        아이템 도감
                    </div>
                    <div class="btn btn-close">
                        X
                    </div>
                </div>
                <div class="body">
                </div>
                <div class="footer">
                    <div class="btn" id="btn-play">가차뽑기</div>
                </div>
            </div>
            <div class="popup" id="popup-outgame">
                <div class="head">
                    <div>
                        테마 완성~!
                    </div>
                    <div class="btn">닫기</div>
                </div>
                <div class="body">
                    테마를 완성했습니다<br/>
                    가차로 뽑을 수 있어요~!
                </div>
                <div class="footer">
                    <div class="btn" id="btn-play">가차뽑기</div>
                </div>
            </div>
        </div>
    </body>
    <script>
        let popupStack = [];

        $(function(){
            initEpisode();
            initItemList();
            $("#stage").load("scene/intro.html"); 
            setTimeout(() => {
                changeScene('lobby');
            }, 1000);
        });

        function initEpisode() {
            let episodeList = $('#popup-episode > .body');
            for(let j=0; j < 20; j++) {
                episodeList.append(
                `<div class="item episode btn btn-scene" target="episode">
                    <div class="desc">
                        episode${j+1}
                    </div>
                    <div class="percent">
                        99%
                    </div>
                </div>`
                );
            }
            let episodes = $('#popup-episode .episode');
            for(let i=0; i < episodes.length; i++) {
                let episode = $(episodes[i]);
                episode.css('background-image', `url('assets/icon${i+1}.png')`);
            }
            $('.btn').click(onBtnClick);
        }

        function initItemList() {
            let episodeList = $('#popup-itemlist > .body');
            for(let j=0; j < 20; j++) {
                episodeList.append(
                `<div class="item episode-item btn"">
                    <div class="desc">
                        아이템1
                    </div>
                </div>`
                );
            }
            // let episodes = $('#popup-itemlist .episode-item');
            // for(let i=0; i < episodes.length; i++) {
            //     let episode = $(episodes[i]);
            //     episode.css('background-image', `url('assets/icon${i+1}.png')`);
            // }
            $('.btn').click(onBtnClick);
        }

        function changeScene(scene) {
            let stage = $("#stage");
            stage.empty();
            stage.load(`scene/${scene}.html`, () => {
                $('.btn').click(onBtnClick);
            });
        }

        function showPopup(name) {
            let popup = $(`#${name}`);
            popup.show();
            popupStack.push(popup);
        }

        function onBtnClick(evt) {
            let target = $(evt.currentTarget);
            if(target.hasClass('btn-scene')) {
                changeScene(target.attr('target'));
                $('.popup').hide();
            } else if(target.hasClass('btn-popup')) {
                showPopup(target.attr('target'));
            } else {
                $('.popup').hide();
            }
        }

        function findParentByClass(target, className) {
            while(target.parent()) {
                if(target.parent().hasClass(className)) {
                    return target.parent();
                }
            }
            return null;
        }
    </script>
</html>